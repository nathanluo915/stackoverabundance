<% if current_user %>
  <% if current_user.voted_for?(votable) %>
    <% vote = Vote.your_vote(current_user, votable) %>
    <% if current_user.upvoted?(votable) %>

      <div>
      <%= form_for vote, url: "/votes/#{vote.id}", method: :delete, html:{class: :upvoted} do |f| %>
        <%= submit_tag('upvote') %>
      <% end %>
      </div>
      <div>
        <%= votable.total_votes %>
      </div>
      <div>
      <%= form_for vote, url: "/votes/#{vote.id}", method: :put, html:{class: :downvote} do |f| %>
        <%= submit_tag('downvote') %>
      <% end %>
      </div>

    <% else %>

      <div>
      <%= form_for vote, url: "/votes/#{vote.id}", method: :put, html:{class: :upvote} do |f| %>
        <%= submit_tag('upvote') %>
      <% end %>
      </div>
      <div>
        <%= votable.total_votes %>
      </div>
      <div>
      <%= form_for vote, url: "/votes/#{vote.id}", method: :delete, html:{class: :downvoted} do |f| %>
        <%= submit_tag('downvote') %>
      <% end %>
      </div>
    <% end %>

  <% else %>
    <div>
    <%= form_for [votable, Vote.new], html:{class: :upvote} do |f| %>
    <%= f.hidden_field :user_id, value: current_user.id %>
    <%= f.hidden_field :votable_type, value: votable.class %>
    <%= f.hidden_field :votable_id, value: votable.id %>
    <%= f.hidden_field :upvote, value: true %>
    <%= submit_tag('upvote') %>
    <% end %>
    </div>
    <div>
      <%= votable.total_votes %>
    </div>
    <div>
    <%= form_for [votable, Vote.new], html:{class: :downvote} do |f| %>
    <%= f.hidden_field :user_id, value: current_user.id %>
    <%= f.hidden_field :votable_type, value: votable.class %>
    <%= f.hidden_field :votable_id, value: votable.id %>
    <%= f.hidden_field :upvote, value: false %>
    <%= submit_tag('downvote') %>
    <% end %>
    </div>
  <% end %>

<% else %>
  <div>
    <%= votable.total_votes %>
  </div>
<% end %>
